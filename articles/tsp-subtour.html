<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Traveling Salesperson Problem using Subtour Elimination Constraints â€¢ rmpk</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Traveling Salesperson Problem using Subtour Elimination Constraints">
<meta property="og:description" content="rmpk">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rmpk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/problem-course-assignment.html">Assigning students to courses</a>
    </li>
    <li>
      <a href="../articles/problem-markowitz.html">Simple Markowitz Portfolio Optimzation Problem</a>
    </li>
    <li>
      <a href="../articles/problem-tsp.html">The Traveling Salesman Problem</a>
    </li>
    <li>
      <a href="../articles/problem-warehouse-location.html">The Warehouse Location Problem</a>
    </li>
    <li>
      <a href="../articles/tsp-subtour.html">Traveling Salesperson Problem using Subtour Elimination Constraints</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tsp-subtour_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Traveling Salesperson Problem using Subtour Elimination Constraints</h1>
            
      
      
      <div class="hidden name"><code>tsp-subtour.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette describes how to solve a TSP using <code>rmpk</code> and subtour elimination constraints using solver callbacks.</p>
<p><a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem">Wikipedia</a> gives the following definition:</p>
<blockquote>
<p>The travelling salesman problem (TSP) asks the following question: Given a list of cities and the distances between each pair of cities, what is the shortest possible route that visits each city exactly once and returns to the origin city?</p>
</blockquote>
<p>Also that Wikipedia article is a good starting point if you want to know more about the topic.</p>
<p>With the basic definition you have a set of verticies (cities) and a set of edges (connection between cities). Each edge has an associated distance <span class="math inline">\(d &gt; 0\)</span>. That distance could be travel time, distance in km or the monetary cost associated with traveling from one city to another. Restrictions on the distances lead to special cases of the problem. For example the <em>metric-TSP</em> requires that the triangle inequality holds for all triples of edges.</p>
<p>In this vignette we will construct a TSP with random points within an Euclidean space.</p>
</div>
<div id="setting" class="section level2">
<h2 class="hasAnchor">
<a href="#setting" class="anchor"></a>Setting</h2>
<p>First let us import some librarys</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>The number of cities:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">20</span></code></pre></div>
<p>Boundary of our Euclidean space:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># from 0 to ...</span>
<span class="va">max_x</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">max_y</span> <span class="op">&lt;-</span> <span class="fl">500</span></code></pre></div>
<p>Some random cities:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="va">cities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, max <span class="op">=</span> <span class="va">max_x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, max <span class="op">=</span> <span class="va">max_y</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cities</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="tsp-subtour_files/figure-html/unnamed-chunk-6-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Now the distance matrix</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cities</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, diag <span class="op">=</span> <span class="cn">TRUE</span>, upper <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-formulation" class="section level2">
<h2 class="hasAnchor">
<a href="#model-formulation" class="anchor"></a>Model formulation</h2>
<p>There are essential two prominent ways to model a TSP as a MILP. One is to formulate the full model using the Millerâ€“Tuckerâ€“Zemlin (MTZ) formulation and the other option is to use the so-called sub-tour elimination constraints .<a href="https://www.unc.edu/~pataki/papers/teachtsp.pdf">1</a></p>
<p>The first formulation is fairly compact (quadratic many constraints and variables) but is not suitable anymore when n gets larger. The second formulation has exponential many constraints at most, but can solve larger TSPs due to the better LP relaxation. The idea of the latter approach is add constraints to the model <em>during</em> the solution process as soon as a solution was found that contains a sub-tour. For solution strategies like this solvers usually offer callbacks that letâ€™s you modify the model during the the branch-and-cut process.</p>
<p>In this article we implement the model shown in the TSP <a href="http://examples.gurobi.com/traveling-salesman-problem/">Gurobi Example</a>, but instead of Gurobi we will use GLPK to solve it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rmpk</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">GLPKoptimizer</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">solver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GLPKoptimizer/man/GLPK_optimizer.html">GLPK_optimizer</a></span><span class="op">(</span>presolve <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimization_model.html">optimization_model</a></span><span class="op">(</span><span class="va">solver</span><span class="op">)</span>

<span class="co"># we create a variable that is 1 iff we travel from city i to j</span>
<span class="co"># filter guards are not yet supported so we generate all possible combinations</span>
<span class="co"># although the graph is undirected</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">add_variable</span><span class="op">(</span><span class="st">"x"</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,
                   type <span class="op">=</span> <span class="st">"integer"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># minimize travel distance</span>
<span class="va">model</span><span class="op">$</span><span class="fu">set_objective</span><span class="op">(</span><span class="fu"><a href="../reference/sum_expr.html">sum_expr</a></span><span class="op">(</span><span class="va">distance</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>, <span class="st">"min"</span><span class="op">)</span>

<span class="co"># you cannot go to the same city</span>
<span class="va">model</span><span class="op">$</span><span class="fu">set_bounds</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">i</span><span class="op">]</span>, ub <span class="op">=</span> <span class="fl">0</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>

<span class="co"># the model is undirected</span>
<span class="va">model</span><span class="op">$</span><span class="fu">add_constraint</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">==</span> <span class="va">x</span><span class="op">[</span><span class="va">j</span>, <span class="va">i</span><span class="op">]</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>

<span class="co"># if you enter a node you have to leave it as well</span>
<span class="va">model</span><span class="op">$</span><span class="fu">add_constraint</span><span class="op">(</span><span class="fu"><a href="../reference/sum_expr.html">sum_expr</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>
<span class="va">model</span>
<span class="co">#&gt; MIP Model: </span>
<span class="co">#&gt;   Variables: 400</span>
<span class="co">#&gt;   Constraints: 420</span></code></pre></div>
</div>
<div id="callback" class="section level2">
<h2 class="hasAnchor">
<a href="#callback" class="anchor"></a>Callback</h2>
<p>The callback is invoked whenever there is a new lower bound found in a search node. We first check if all variables are integral. If that is the case then we use the <code>igraph</code> package to check if the shortest circle does not contain all cities. If that is also true we add the sub-tour elimination constraint.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">row_count</span> <span class="op">&lt;-</span> <span class="fl">0L</span> <span class="co">#let's count the number of rows we add</span>
<span class="fu"><a href="https://rdrr.io/pkg/GLPKoptimizer/man/set_irowgen_callback.html">set_irowgen_callback</a></span><span class="op">(</span><span class="va">solver</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># first we construct an adjacency matrix</span>
  <span class="co"># we also stop if we find fractional values</span>
  <span class="va">adjacency_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0L</span>, nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="va">n</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GLPKoptimizer/man/glpk_get_col_prim.html">glpk_get_col_prim</a></span><span class="op">(</span><span class="va">solver</span>, <span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span>
      <span class="va">adjacency_matrix</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">val</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">adjacency_matrix</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">1</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="co"># not all integral</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="co"># find the shortest circle and check if that tour does not contain all the nodes</span>
  <span class="co"># if yes, we add a subtour elimination constraint</span>
  <span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="va">adjacency_matrix</span>, mode <span class="op">=</span> <span class="st">"undirected"</span><span class="op">)</span>
  <span class="va">shortest_circle</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/girth.html">girth</a></span><span class="op">(</span><span class="va">graph</span>, <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">circle_size</span> <span class="op">&lt;-</span> <span class="va">shortest_circle</span><span class="op">$</span><span class="va">girth</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">circle_size</span> <span class="op">&lt;</span> <span class="va">n</span> <span class="op">&amp;&amp;</span> <span class="va">circle_size</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">first_v</span> <span class="op">&lt;-</span> <span class="va">shortest_circle</span><span class="op">$</span><span class="va">circle</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span>
    <span class="va">prev_v</span> <span class="op">&lt;-</span> <span class="va">first_v</span>
    <span class="va">expr</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="va">shortest_circle</span><span class="op">$</span><span class="va">circle</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">circle_size</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">expr</span> <span class="op">&lt;-</span> <span class="va">expr</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">prev_v</span>, <span class="va">v</span><span class="op">]</span>
      <span class="va">prev_v</span> <span class="op">&lt;-</span> <span class="va">v</span>
    <span class="op">}</span>
    <span class="va">expr</span> <span class="op">&lt;-</span> <span class="va">expr</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">prev_v</span>, <span class="va">first_v</span><span class="op">]</span>
    <span class="va">model</span><span class="op">$</span><span class="fu">add_constraint</span><span class="op">(</span><span class="va">expr</span> <span class="op">&lt;=</span> <span class="va">circle_size</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">row_count</span> <span class="op">&lt;&lt;-</span> <span class="va">row_count</span> <span class="op">+</span> <span class="fl">1L</span>
  <span class="op">}</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
<div id="results" class="section level2">
<h2 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h2>
<p>This model can now be solved by one of the many solver libraries.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We added 24 rows during the search process.</p>
<p>To extract the solution we can use <code>get_variable_value</code> method that will return a data.frame which we can further be used with <code>tidyverse</code> packages.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">solution</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">get_variable_value</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">solution</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="right">i</th>
<th align="right">j</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">x</td>
<td align="right">12</td>
<td align="right">10</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">3</td>
<td align="right">19</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">13</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Now we need to link back the indexes in our model with the actual cities.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">solution</span>, <span class="va">i</span>, <span class="va">j</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">i</span>, to <span class="op">=</span> <span class="va">j</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>trip_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">property</span>, <span class="va">idx_val</span>, <span class="va">from</span><span class="op">:</span><span class="va">to</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>idx_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">idx_val</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">cities</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"idx_val"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">paths</span>, <span class="va">trip_id</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">trip_id</th>
<th align="left">property</th>
<th align="right">idx_val</th>
<th align="right">x</th>
<th align="right">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">from</td>
<td align="right">12</td>
<td align="right">359.5561</td>
<td align="right">405.5276</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">to</td>
<td align="right">10</td>
<td align="right">352.5324</td>
<td align="right">418.0021</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">from</td>
<td align="right">3</td>
<td align="right">143.0698</td>
<td align="right">494.4459</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">to</td>
<td align="right">19</td>
<td align="right">237.4985</td>
<td align="right">453.3007</td>
</tr>
</tbody>
</table>
<p>And plot it:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cities</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">paths</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">trip_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Optimal route with cost: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="fu">objective_value</span><span class="op">(</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="tsp-subtour_files/figure-html/unnamed-chunk-14-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="feedback" class="section level2">
<h2 class="hasAnchor">
<a href="#feedback" class="anchor"></a>Feedback</h2>
<p>Do you have any questions, ideas, comments? Or did you find a mistake? Letâ€™s discuss on <a href="https://github.com/r-opt/rmpk/discussions">Github</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dirk Schumacher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
